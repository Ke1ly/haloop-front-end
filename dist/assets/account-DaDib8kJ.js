import{g as E}from"./nav-Bo_706sF.js";async function v(){const o=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)return console.error("Response not OK:",o.status),null;let n=await o.json();return n.success?(console.log("userData",n),n):(console.log("userData",n),null)}async function I(){const o=await v(),n=document.getElementById("helper-profile-btn"),l=document.getElementById("host-profile-btn"),c=document.getElementById("user-profile-btn"),s=document.getElementById("helper-profile-section"),i=document.getElementById("host-profile-section"),d=document.getElementById("user-profile-section");[n,l,c].forEach(t=>{t.addEventListener("click",()=>{[n,l,c].forEach(e=>{e.classList.remove("selected")}),t.classList.add("selected")})}),o?(c.addEventListener("click",()=>{d.style.display="flex",i.style.display="none",s.style.display="none"}),o.user.userType=="HELPER"?(n.style.display="block",l.style.display="none",n.addEventListener("click",()=>{d.style.display="none",i.style.display="none",s.style.display="block"})):o.user.userType=="HOST"?(D(o),k(),l.style.display="block",n.style.display="none",l.addEventListener("click",()=>{d.style.display="none",i.style.display="flex",s.style.display="none"})):location.replace("/")):location.replace("/")}I();function k(){document.querySelectorAll(".toggle-option").forEach(t=>{t.addEventListener("click",()=>{t.classList.toggle("selected")})});const o=E("work-end-date");o.addEventListener("change",()=>{const t=new Date(E("work-start-date").value);new Date(o.value)<=t&&alert("結束時間必須大於起始時間！")});function n(t){const e=document.getElementById(t);return(e==null?void 0:e.value.trim())||""}function l(t){const e=document.getElementById(t);return(e==null?void 0:e.value.trim())||""}function c(t){const e=document.getElementById(t);if(e&&e instanceof HTMLSelectElement){const r=e.value,a=parseInt(r,10);if(!isNaN(a))return a}return 0}function s(t){const e=[];return document.querySelectorAll(`${t}.selected`).forEach(a=>{const u=a.dataset.value;u&&e.push(u)}),e}const i=E("post-work-btn"),d=document.getElementById("host-img-file");i.addEventListener("click",async t=>{t.preventDefault();const e=d.files;console.log("01前端抓取輸入的img檔案",e);const r=[];if(e&&e.length>0){const m=new FormData;Array.from(e).forEach(y=>{m.append("images",y)}),console.log("02前端準備上傳的img檔案",m.getAll("images"));const f=await fetch("/api/uploads",{method:"POST",body:m}),{urls:g}=await f.json();r.push(...g),console.log("06前端收到urls回覆，轉為string list",r)}let a={startDate:n("work-start-date"),endDate:n("work-end-date"),recruitCount:c("recruit-count"),images:r,positionName:n("position-name"),positionCategories:s(".position-category-option-btn"),averageWorkHours:c("average-work-hours"),minDuration:c("min-stay-days"),requirements:s(".required-option-btn"),positionDescription:l("position-description"),accommodations:s(".accommodation-option-btn"),meals:s(".meal-option-btn"),experiences:s(".experience-option-btn"),environments:s(".environment-option-btn"),benefitsDescription:l("benefits-description")};console.log("01前端準備上傳的postData",a);const u=await(await fetch("/api/works",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(a)})).json();console.log("05前端收到",u)})}async function D(o){const n=document.getElementById("username"),l=document.getElementById("realname"),c=document.getElementById("email-address");n.value=o.user.username,l.value=o.user.realname,c.value=o.user.email;const s=await fetch("/api/profile/host",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to fetch work posts");const i=await s.json();if(i.profileData){const t=document.getElementById("unit-name");t.value=i.profileData.unitName;const e=document.getElementById("unit-address");e.value=i.profileData.address;const r=document.getElementById("unit-city");r.value=i.profileData.city;const a=document.getElementById("unit-description");a.value=i.profileData.unitDescription}document.getElementById("save-userform-data-btn").addEventListener("click",async()=>{const t=document.getElementById("unit-name"),e=document.getElementById("unit-address");function r(){const f=document.getElementById("unit-city"),g=document.getElementById("city-list"),y=f.value,B=g.options;for(let h=0;h<B.length;h++)if(B[h].value===y)return y}const a=document.getElementById("unit-description");let p={unitName:t.value,address:e.value,unitDescription:a.value,city:r()};console.log("01前端送出Data",p);const m=await(await fetch("/api/profile/host",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(p)})).json();console.log("前端獲得 profileResponseData",m)})}
