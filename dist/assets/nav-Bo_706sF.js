(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();function r(n){const e=document.getElementById(n);if(!e)throw new Error(`Element with id ${n} not found`);return e}function C(n,e){const s=n.querySelector(e);if(!s)throw new Error(`Element with selector '${e}' not found.`);return s}function S(n){return function(s){const c=n.getBoundingClientRect();(s.clientX<c.left||s.clientX>c.right||s.clientY<c.top||s.clientY>c.bottom)&&(n.close(),n.classList.remove("show"))}}function L(){const n=document.querySelectorAll(".sign-up-role"),e=document.querySelectorAll(".sign-in-role");[n,e].forEach(a=>{a.forEach(i=>{i.addEventListener("click",()=>{a.forEach(l=>l.classList.remove("selected")),i.classList.add("selected")})})});function s(a){const l=document.querySelector(`${a}.selected`);return(l==null?void 0:l.dataset.value)||""}const c=r("sign-up-div"),t=r("sign-up-dialog");c.addEventListener("click",()=>{t.showModal(),t.classList.add("show")});const o=r("sign-in-div"),u=r("sign-in-dialog");o.addEventListener("click",()=>{u.showModal(),u.classList.add("show")}),t.addEventListener("click",S(t)),u.addEventListener("click",S(u)),r("sign-up-form").addEventListener("submit",async a=>{a.preventDefault();const i=r("sign-up-response-message");i.replaceChildren();const l=r("sign-up-email").value,g=r("sign-up-passsword").value,p=r("sign-up-username").value,h=r("sign-up-realname").value,f=s(".sign-up-role");console.log({email:l,password:g,username:p,realname:h,userType:f}),!p||!h||!l||!g||!f?d(i,"請填打所有欄位","red"):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)||d(i,"請輸入正確的電子郵件","red");let m=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,realname:h,email:l,password:g,userType:f})});if(!m.ok){let k=await m.json();throw d(i,k.message||"註冊時發生錯誤","red"),new Error(k.message||"註冊時發生錯誤")}const E=await m.json();E.success?(localStorage.setItem("token",E.token),d(i,"註冊成功","green"),console.log("註冊成功:",E)):alert(E.message)});function d(a,i,l){a.textContent=i,a.style.color=l,a.style.marginBottom="10px"}r("sign-in-form").addEventListener("submit",async a=>{a.preventDefault();const i=r("sign-in-response-message");i.replaceChildren();const l=r("sign-in-email").value,g=r("sign-in-password").value,p=s(".sign-in-role");console.log({email:l,password:g,userType:p}),!l||!g||!p?d(i,"請填打所有欄位","red"):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)||d(i,"請輸入正確的電子郵件","red");let f=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,password:g})});if(!f.ok){let m=await f.json();throw d(i,"登入時發生錯誤",m.message),new Error(m.message||"登入時發生錯誤")}const y=await f.json();y.success?(localStorage.setItem("token",y.token),d(i,"登入成功","green"),console.log("登入成功:",y),location.reload()):alert(y.message)})}function B(){document.querySelectorAll(".log-out-btn").forEach(s=>{s.addEventListener("click",()=>{console.log("logOutBtns"),localStorage.removeItem("token"),location.reload()})}),document.querySelectorAll(".account-management-btn").forEach(s=>{s.onclick=()=>{window.location.assign("./account")}})}async function I(){let e=await(await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();return e.success?(console.log("userData",e),e):(console.log("userData",e),null)}async function b(){let n=localStorage.getItem("token");if(console.log(n),!n||n=="undefined")w(null),L();else{const e=await I();e?(w(e.user.userType),B(),e.user.userType=="HELPER"&&D(e.user.id)):(w(null),L())}}b();function w(n){const e=document.getElementById("visitor-menu"),s=document.getElementById("helper-menu"),c=document.getElementById("host-menu"),t=r("show-menu-btn");n=="HELPER"?t.addEventListener("click",()=>{s.style.display=="block"?s.style.display="none":s.style.display="block"}):n=="HOST"?t.addEventListener("click",()=>{c.style.display=="block"?c.style.display="none":c.style.display="block"}):t.addEventListener("click",()=>{e.style.display=="block"?e.style.display="none":e.style.display="block"})}const O=document.querySelector(".fa-bell"),v=document.getElementById("notification-list");O.addEventListener("click",()=>{v.style.display=="block"?v.style.display="none":v.style.display="block"});function D(n){const e=new EventSource(`/api/notification/stream/${n}`);e.onmessage=s=>{const c=JSON.parse(s.data),t=document.getElementById("notification-list"),o=document.getElementById("notification-count"),u=document.createElement("div");u.innerText=c.message,t==null||t.appendChild(u);const d=parseInt((o==null?void 0:o.innerText)||"0");o.innerText=(d+1).toString()}}export{S as c,r as g,C as q};
